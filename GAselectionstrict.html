<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>First in Business | GA Top 10 Screener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        .candidate-card { transition: transform 0.2s; }
        .candidate-card:hover { transform: translateY(-2px); }
        .top-10-border { border: 2px solid #6366f1; position: relative; }
        .rank-badge { position: absolute; top: -10px; left: -10px; background: #6366f1; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">

    <nav class="bg-indigo-900 text-white p-6 shadow-xl mb-8">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold italic">First in Business</h1>
                <p class="text-indigo-200 text-sm">GA Application Processing Portal (FERPA Secure)</p>
            </div>
            <div class="text-right">
                <p class="text-xs uppercase tracking-widest opacity-70">Requirement Filter</p>
                <p class="font-mono text-emerald-400">Master's Degree Enforced</p>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6">
        <div id="uploadArea" class="bg-white border-4 border-dashed border-gray-200 rounded-3xl p-12 text-center mb-10 transition-colors hover:border-indigo-300">
            <input type="file" id="pdfUpload" class="hidden" accept="application/pdf">
            <label for="pdfUpload" class="cursor-pointer">
                <div class="bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-700">Upload Master PDF</h2>
                <p class="text-gray-500 mt-2">Upload the combined PDF of 121 applications.<br>The tool will auto-split and rank the Top 10.</p>
            </label>
            <div id="status" class="mt-4 text-indigo-600 font-medium hidden italic">Processing candidates... please wait.</div>
        </div>

        <div id="resultsWrapper" class="hidden">
            <div class="flex justify-between items-end mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Top 10 Recommended Matches</h2>
                <span id="matchCount" class="bg-indigo-100 text-indigo-700 px-4 py-1 rounded-full text-sm font-bold"></span>
            </div>
            
            <div id="topTenList" class="grid grid-cols-1 gap-4 mb-12">
                </div>

            <hr class="my-10 border-gray-200">
            
            <h3 class="text-lg font-bold text-gray-500 mb-4 tracking-tight uppercase">Other Qualified Candidates</h3>
            <div id="othersList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
        </div>
    </main>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const pdfUpload = document.getElementById('pdfUpload');
        const status = document.getElementById('status');
        
        pdfUpload.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            status.classList.remove('hidden');
            const reader = new FileReader();
            
            reader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let fullText = "";

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    const strings = content.items.map(item => item.str);
                    fullText += strings.join(" ") + "\n---PAGE_BREAK---\n";
                }

                // Split by the specific application header
                const candidateSections = fullText.split(/On Campus Student Employment Application/i);
                processCandidates(candidateSections);
            };
            reader.readAsArrayBuffer(file);
        });

        function processCandidates(sections) {
            let processed = [];

            sections.forEach((section, index) => {
                if (section.trim().length < 100) return;

                const isMasters = /master|graduate|MBA|M\.S\.|M\.A\./i.test(section);
                if (!isMasters) return; // FERPA-safe filter: only grad students

                // Keyword Scoring
                const scores = {
                    lead: (section.match(/president|vp|officer|chair|lead|organization|engagement/gi) || []).length * 8,
                    events: (section.match(/event|planning|logistics|coordinator|catering/gi) || []).length * 6,
                    service: (section.match(/customer|client|service|retail|communication/gi) || []).length * 4
                };

                // Weighted Total
                const totalScore = (scores.lead * 0.5) + (scores.events * 0.3) + (scores.service * 0.2);

                // Attempt to grab name (usually the first few words of a resume block)
                const nameMatch = section.trim().split(/\s+/).slice(0, 3).join(" ");

                processed.push({
                    name: nameMatch || `Candidate ${index}`,
                    scores,
                    totalScore: Math.round(totalScore),
                    preview: section.substring(0, 200) + "..."
                });
            });

            // Sort by Rank
            processed.sort((a, b) => b.totalScore - a.totalScore);
            renderUI(processed);
        }

        function renderUI(list) {
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('resultsWrapper').classList.remove('hidden');
            document.getElementById('matchCount').innerText = `${list.length} Grad Candidates Found`;

            const topTen = list.slice(0, 10);
            const others = list.slice(10);

            const listToHTML = (item, index, isTop) => `
                <div class="candidate-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center ${isTop ? 'top-10-border shadow-md' : ''}">
                    ${isTop ? `<div class="rank-badge">${index + 1}</div>` : ''}
                    <div class="flex-1">
                        <h4 class="text-lg font-bold text-indigo-900">${item.name}</h4>
                        <p class="text-xs text-gray-400 mt-1 uppercase font-semibold">Master's Student Verified</p>
                        <p class="text-sm text-gray-500 mt-2 italic">"${item.preview}"</p>
                    </div>
                    <div class="flex space-x-4 text-center border-l pl-6 ml-6 border-gray-100">
                        <div>
                            <p class="text-[10px] text-gray-400 font-bold uppercase">Leadership</p>
                            <p class="text-lg font-bold text-indigo-600">${item.scores.lead}</p>
                        </div>
                        <div>
                            <p class="text-[10px] text-gray-400 font-bold uppercase">Events</p>
                            <p class="text-lg font-bold text-purple-600">${item.scores.events}</p>
                        </div>
                        <div class="bg-indigo-50 px-4 py-1 rounded-xl">
                            <p class="text-[10px] text-indigo-400 font-bold uppercase">Match Score</p>
                            <p class="text-xl font-black text-indigo-700">${item.totalScore}</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('topTenList').innerHTML = topTen.map((c, i) => listToHTML(c, i, true)).join('');
            document.getElementById('othersList').innerHTML = others.map((c, i) => listToHTML(c, i, false)).join('');
        }
    </script>
</body>
</html>
